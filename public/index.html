<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Diary</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* General Body Styling */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image:url("https://images.pexels.com/photos/220067/pexels-photo-220067.jpeg");
      background-size: cover;
      background-position: right;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height:100vh;
    }

    h1 {
      color:transparent;
      background-image:url("https://images.pexels.com/photos/207353/pexels-photo-207353.jpeg");
      background-clip:text;
      background-position: center;
      margin-top: 40px;
      margin-bottom: 20px;
      font-size: 2.5rem;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }

    /* Form Styling */
    form {
      background: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-width: 500px;
      width: 100%;
      margin-bottom: 30px;
    }

    form label {
      font-weight: 600;
      color: #555;
    }

    form input, 
    form select, 
    form textarea {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      margin-bottom: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      outline: none;
      transition: all 0.2s ease;
    }

    form input:focus,
    form select:focus,
    form textarea:focus {
      border-color: #4a90e2;
      box-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
    }

    form button {
      background-color: #4a90e2;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    form button:hover {
      background-color: #357ABD;
    }

    /* Entries Section */
    #entries {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 90%;
      max-width: 700px;
      margin-bottom: 30px;
    }

    .entry-card {
      background: #fff;
      width: 100%;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 12px;
      position: relative;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

.fa-trash-can{
  position: absolute;
  left:95%;
font-size:20px;
}
    .entry-card:hover {
      transform: translateY(-3px);
    }

    .entry-card p {
      margin: 5px 0;
      color: #333;
    }

    /* Color-coded moods */
    .happy { border-left: 6px solid #4caf50; }
    .neutral { border-left: 6px solid #ff9800; }
    .sad { border-left: 6px solid #f44336; }

    /* Mood Chart */
    #mood-chart {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 90%;
      margin-bottom: 50px;
    }
  </style>
</head>
<body>
  <h1>Digital Diary</h1>
  
  <!-- Entry Form -->
  <form id="entry-form">
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required>

    <label for="mood">Mood:</label>
    <select id="mood" name="mood" required>
      <option value="happy">Happy</option>
      <option value="sad">Sad</option>
      <option value="neutral">Neutral</option>
    </select>

    <label for="entry">Entry:</label>
    <textarea id="entry" name="entry" rows="4" required></textarea>

    <button type="submit">Submit</button>
  </form>

  <!-- Entries Display -->
  <div id="entries"></div>

  <!-- Mood Chart -->
  <canvas id="mood-chart"></canvas>

  <script>
    const form = document.getElementById('entry-form');
    const entriesDiv = document.getElementById('entries');
    const moodChart = document.getElementById('mood-chart');
    const close = document.querySelector(".fa-close");

    function deleteEntry(id) {
  fetch(`/api/entries/${id}`, {
    method: "DELETE",
  })
  .then(res => res.json())
  .then(data => {
    console.log(data);
    window.location.reload(); // Refresh entries
  })
  .catch(err => console.error(err));
}

  // Submit New Entry
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const mood = document.getElementById('mood').value;
      const entry = document.getElementById('entry').value;

      fetch('/api/entries', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ date, mood, entry }),
      })
      .then(res => res.json())
      .then(data => {
        console.log(data);
        window.location.reload(); // refresh to show new entry
      })
      .catch(err => console.error(err));
    });

    // Fetch and display all entries
    fetch('/api/entries')
      .then(res => res.json())
      .then(entries => {
        let html = '';
        entries.forEach(entry => {
          html += `<div class="entry-card ${entry.mood}">
                     <i class="fa-solid fa-trash-can" onclick="deleteEntry(${entry.id})"></i>
                     <p><strong>Date:</strong> ${entry.date}</p>
                     <p><strong>Mood:</strong> ${entry.mood}</p>
                     <p><strong>Entry:</strong> ${entry.entry}</p>
                   </div>`;
        });
        entriesDiv.innerHTML = html;

        // Prepare chart data
        const moodData = {
          labels: entries.map(e => e.date),
          datasets: [{
            label: 'Mood',
            data: entries.map(e => e.mood === 'happy' ? 1 : e.mood === 'sad' ? -1 : 0),
            backgroundColor: 'rgba(74, 144, 226, 0.2)',
            borderColor: 'rgba(74, 144, 226, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true,
          }]
        };

        new Chart(moodChart, {
          type: 'line',
          data: moodData,
          options: {
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value === 1 ? 'Happy' : value === -1 ? 'Sad' : 'Neutral';
                  }
                }
              }
            }
          }
        });
      })
      .catch(err => console.error(err));

  </script>
</body>
</html>
